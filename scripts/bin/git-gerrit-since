#!/usr/bin/perl

use strict;
use warnings;

my $since = $ARGV[0];
if (!defined($since)) {
    die("Usage: $0 <since>");
}

if (!($since =~ m/[.][.]/)) {
    $since = "$since..HEAD";
}

my $last_gerrit;
my $last_subject;

sub
next_commit()
{
    return if (!defined($last_gerrit));
    print "$last_gerrit: $last_subject\n";
    $last_gerrit = undef;
    $last_subject = undef;
}

open(my $ph, '-|', 'git', 'log', '--reverse', $since)
    or die("Cannot run git log: $!\n");

while (<$ph>) {
    chomp;

    if (m/^commit /) {
        next_commit();
        next;
    }

    if (!defined($last_subject) && m/^\s+(.*)$/) {
        $last_subject = $1;
    }

    if (m,^\s+Reviewed-on:.*/(\d+),) {
        $last_gerrit = $1;
        next;
    }
}

next_commit();

close($ph);
